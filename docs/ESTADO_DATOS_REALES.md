# Estado de Datos del Portal Energ√©tico

## üö® ESTADO ACTUAL DE LA API DE XM

**API de XM: ‚ùå NO DISPONIBLE**
- Servidor: `servapibi.xm.com.co`
- Error: Connection timeout
- Estado: La API de XM no est√° respondiendo desde hace varias horas

## üìä M√©tricas de XM que DEBER√çAN Usarse (cuando funcione)

### 1. Fichas de Hidrolog√≠a (`/generacion`)

| Ficha | M√©trica XM | Entidad | Descripci√≥n | Estado Actual |
|-------|------------|---------|-------------|---------------|
| **Reservas H√≠dricas** | `VolEmbalDiar` | `Sistema` | Volumen de embalses en GWh y % | ‚ùå Usando fallback |
| **Aportes H√≠dricos** | `AporEner` | `Sistema` | Aportes de energ√≠a en GWh y % | ‚ùå Usando fallback |
| **Generaci√≥n SIN** | `Gene` | `Sistema` | Generaci√≥n total del SIN en GWh | ‚ùå Usando fallback |

**C√≥digo actual:**
```python
# pages/generacion.py l√≠neas 43-53
df_reservas = fetch_metric_data('VolEmbalDiar', 'Sistema', fecha_inicio, fecha_fin)
df_aportes = fetch_metric_data('AporEner', 'Sistema', fecha_inicio, fecha_fin)
df_generacion = fetch_metric_data('Gene', 'Sistema', fecha_inicio, fecha_fin)
```

### 2. Fichas de Generaci√≥n XM (`/generacion/fuentes`)

| Ficha | C√°lculo | M√©trica XM Base | Estado Actual |
|-------|---------|-----------------|---------------|
| **Generaci√≥n Renovable %** | % de HIDRAULICA + EOLICA + SOLAR + BIOMASA | `Gene/Recurso` | ‚ùå Usando fallback |
| **Generaci√≥n No Renovable %** | % de TERMICA GAS + TERMICA CARBON + otras | `Gene/Recurso` | ‚ùå Usando fallback |
| **Generaci√≥n Total** | Suma total en GWh | `Gene/Recurso` | ‚ùå Usando fallback |

**C√≥digo actual:**
```python
# pages/generacion_fuentes_unificado.py l√≠neas 51-76
df_gene_recurso = fetch_metric_data('Gene', 'Recurso', fecha_inicio, fecha_fin)

# Clasificar como renovable o no renovable
renovables = ['HIDRAULICA', 'EOLICA', 'SOLAR', 'BIOMASA']
df_gene_recurso['Es_Renovable'] = df_gene_recurso['Tipo'].apply(
    lambda x: any(r in str(x) for r in renovables)
)

gen_renovable = df_gene_recurso[df_gene_recurso['Es_Renovable'] == True]['Values_gwh'].sum()
gen_no_renovable = df_gene_recurso[df_gene_recurso['Es_Renovable'] == False]['Values_gwh'].sum()
```

## üé≠ DATOS ACTUALES: Reales vs Fallback

### Datos de Fallback (Est√°ticos - NO REALES)

**Archivo:** `pages/generacion.py`

```python
# L√≠neas 128-218 - DATOS INVENTADOS
reserva_gwh = 14000      # ‚ùå INVENTADO
reserva_pct = 83.29      # ‚ùå INVENTADO
aporte_gwh = 220.62      # ‚ùå INVENTADO
aporte_pct = 89.51       # ‚ùå INVENTADO
gen_gwh = 198.45         # ‚ùå INVENTADO
```

**Archivo:** `pages/generacion_fuentes_unificado.py`

```python
# L√≠neas 78-80 - DATOS INVENTADOS
pct_renovable = 70.31      # ‚ùå INVENTADO
pct_no_renovable = 29.69   # ‚ùå INVENTADO
gen_total = 26864.17       # ‚ùå INVENTADO
```

### ¬øDe D√≥nde Vienen Estos N√∫meros?

Los valores de fallback fueron **copiados de la p√°gina de XM**:
- https://sinergox.xm.com.co/Paginas/Home.aspx

**Pero son est√°ticos** - fueron tomados en un momento espec√≠fico y NO se actualizan.

## ‚úÖ SOLUCI√ìN: Qu√© Hacer Cuando la API Funcione

### Opci√≥n 1: Esperar a que XM arregle su API
```bash
# Verificar estado
curl -I https://servapibi.xm.com.co/Lists --max-time 5
```

### Opci√≥n 2: Usar datos del d√≠a anterior (de respaldo)
XM publica datos oficiales en:
- https://www.xm.com.co/consumo/demanda-de-energia-sin

### Opci√≥n 3: Scraping directo de la p√°gina de XM
```python
# Hacer scraping de https://sinergox.xm.com.co/
# Extraer valores directamente del HTML
```

## üîç Verificar Estado de la API

Ejecutar este script para verificar:

```bash
python3 << 'EOF'
from pydataxm.pydataxm import ReadDB
from datetime import date, timedelta

try:
    api = ReadDB()
    print("‚úÖ API conectada")
    
    # Probar consulta simple
    data = api.request_data(
        'Gene', 
        'Sistema', 
        date.today() - timedelta(days=7),
        date.today() - timedelta(days=1)
    )
    
    if data is not None:
        print(f"‚úÖ Datos obtenidos: {len(data)} filas")
        print(f"Columnas: {data.columns.tolist()}")
    else:
        print("‚ö†Ô∏è API conectada pero sin datos")
        
except Exception as e:
    print(f"‚ùå API no disponible: {e}")
EOF
```

## üìù Resumen

| Componente | Fuente de Datos | Estado | Acci√≥n Requerida |
|------------|----------------|--------|------------------|
| Reservas H√≠dricas | XM API: `VolEmbalDiar/Sistema` | ‚ùå Fallback | Esperar API |
| Aportes H√≠dricos | XM API: `AporEner/Sistema` | ‚ùå Fallback | Esperar API |
| Generaci√≥n SIN | XM API: `Gene/Sistema` | ‚ùå Fallback | Esperar API |
| Gen. Renovable % | XM API: `Gene/Recurso` (calculado) | ‚ùå Fallback | Esperar API |
| Gen. No Renovable % | XM API: `Gene/Recurso` (calculado) | ‚ùå Fallback | Esperar API |
| Gen. Total | XM API: `Gene/Recurso` (suma) | ‚ùå Fallback | Esperar API |

## ‚ö†Ô∏è CONCLUSI√ìN

**TODOS LOS DATOS ACTUALES SON DE FALLBACK (INVENTADOS)**

La aplicaci√≥n est√° mostrando valores est√°ticos porque:
1. ‚ùå La API de XM no responde
2. ‚ùå No hay cach√© previo con datos reales
3. ‚úÖ El sistema usa fallback para evitar errores 500

**Cuando la API de XM vuelva a funcionar:**
- ‚úÖ Los datos se actualizar√°n autom√°ticamente
- ‚úÖ Se guardar√°n en cach√©
- ‚úÖ Las fichas mostrar√°n valores reales
